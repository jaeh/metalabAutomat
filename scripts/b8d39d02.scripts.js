"use strict";angular.module("automatApp",["ngRoute","ngSanitize","ngTouch","pouchdb","hc.marked","mgcrea.ngStrap","ab-base64"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("automatApp").controller("MainCtrl",["$scope","$http","$interval","base64","pouchdb","database",function(a,b,c,d,e,f){var g="683b134e2e89d670c797e1d77e9e6bfca3b62192",h="https://api.github.com/repos/zerocity/metalabAutomat/contents/",i="https://api.github.com/repos/zerocity/metalabAutomat/git/trees/master",j="?callback=JSON_CALLBACK",k="&recursive=1",l="&access_token="+g,m={headers:{Authorization:"token "+g,Accept:"application/vnd.github-blob.raw","X-Testing":"testing"}};a.progressBar=0;var n=f,o=function(a){return d.decode(a.replace(/\n/g,""))},p=function(){n.get("lastModified").then(function(b){a.lastModified=b[b.length-1].lastModified})},q=function(){var c=b.jsonp(h+j+l);return"undefined"!=typeof a.lastModified?(p(),c.then(function(b){return b.data.meta["Last-Modified"]===a.lastModified?!0:!1})):void p()},r=function(){var c=[],d=[],e=b.jsonp(i+j+k+l,m);e.then(function(b){n.put({_id:"lastModified",lastModified:b.data.meta["Last-Modified"]}).then(function(a){console.log(a)}).catch(function(a){console.log(a)}),p();var e=b.data.data.tree;a.maxProgress=e.length;for(var f=0;f<e.length;f++){var g=e[f].path,h=g.indexOf(".md");a.img;var i=g.indexOf("listview.jpg"),j=g.indexOf("/")+1,k=g.slice(0,j-1);if(h>=0){var l=g.slice(j,h),m=l.match(/\d+ Euro/);m=m?m[0]:"",c.push({dir:k,title:l,euro:m,url:e[f].url}),s(e[f].url,k).then(function(b){a.progressBar++;var d=_.findWhere(c,{dir:b.dir});d.md=b.src})}else i>=0?s(e[f].url,k).then(function(b){var f=_.findWhere(c,{dir:b.dir});f.src=b.src,d.push(f),a.progressBar++,a.progressBar===e.length&&(console.log("Data is inserted in indexedDB"),n.put({_id:"github",data:d}).then(function(a){console.log(a)}).catch(function(a){console.log(a)}),a.data=d)}):a.progressBar++}})};a.isProgressActive=function(){return a.progressBar===a.maxProgress||0===a.progressBar?"hide":"active"};var s=function(a,c){return b.jsonp(a+j+l,m).then(function(a){return{src:a.data.data.content,dir:c}})};n.get("github").then(function(b){a.data=b.data}).catch(function(a){404==a.status?r():console.log(a)}),c(function(){q().then(function(a){a===!1&&r()})},36e5),a.setModalContent=function(b){var c=_.findWhere(a.data,{dir:b});a.modal.title=c.title,a.modal.content=c.md,a.modal.src=c.src,a.modal.euro=c.euro,$(".box").toggleClass("hide"),$("#productView").toggleClass("hide")},a.closeProductView=function(){$("#productView").toggleClass("hide"),$(".box").toggleClass("hide")},a.modal={title:void 0,content:void 0,img:void 0},a.markdown=function(){return"undefined"==typeof a.modal.content?"loading ...":marked(o(a.modal.content))}}]),angular.module("automatApp").factory("database",["pouchdb",function(a){return a.create("automat")}]);